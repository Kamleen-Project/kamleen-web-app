# Kamleen Project Direction & Guidelines

## 1. Project Overview
**Kamleen** is a comprehensive platform for booking activities and experiences. It connects "Explorers" (users looking for experiences) with "Organizers" (providers of experiences). The platform handles everything from experience listing and verification to booking, payments, and ticketing.

## 2. Technology Stack
- **Framework**: Next.js 15 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS 4, Shadcn UI, Lucide React (Icons)
- **Database**: PostgreSQL
- **ORM**: Prisma
- **Authentication**: NextAuth.js (v4)
- **Testing**: Robot Framework, Playwright
- **Deployment**: Vercel (implied)
- **Other Key Libs**: `date-fns`, `zod` (implied via Shadcn forms), `react-hook-form` (implied), `nodemailer`.

## 3. Project Structure
- **`src/app`**: Application routes (Next.js App Router).
    - `(auth)`: Authentication related pages.
    - `(dashboard)`: Protected routes for Organizers/Admins (likely).
    - `api`: Backend API routes.
- **`src/components`**:
    - `ui`: Reusable primitive components (Shadcn).
    - `layout`: Header, Footer, etc.
    - Feature-specific folders: `experiences`, `organizer`, `admin`, etc.
- **`src/lib`**: Utility functions, configuration, and shared logic.
    - `prisma.ts`: Singleton Prisma client instance.
    - `auth.ts` / `auth-options.ts`: NextAuth configuration.
    - `utils.ts`: CN helper and other common utilities.
- **`prisma`**: Database schema (`schema.prisma`) and migrations.
- **`tests`**: End-to-end tests using Robot Framework.

## 4. Key Concepts & Data Model
- **Users**: Have roles (`EXPLORER`, `ORGANIZER`, `ADMIN`). A user can switch active roles.
- **Experiences**: The core product. Has a lifecycle: `DRAFT` -> `PUBLISHED` -> `ARCHIVED`.
    - Linked to `Country`, `State`, `City`.
    - Has `ExperienceSession`s (specific dates/times).
- **Bookings**: `ExperienceBooking` links a `User` to an `ExperienceSession`.
    - Statuses: `PENDING`, `CONFIRMED`, `CANCELLED`.
- **Payments**: Handled via `Payment` model. Supports multiple providers (Stripe, CMI, etc.).
- **Tickets**: Generated upon confirmed booking.

## 5. Development Guidelines (How to avoid bugs)

### General
- **Strict TypeScript**: Always use proper types. Avoid `any`. Use the types generated by Prisma (`@prisma/client`).
- **Server Components**: Default to Server Components. Use `"use client"` only when interactivity (hooks, event listeners) is needed.

### Database & Prisma
- **Schema Changes**: When modifying `schema.prisma`, always run `npx prisma migrate dev` to create a migration and update the client.
- **Queries**: Use `src/lib/prisma.ts` to import the `db` client. Do not instantiate new PrismaClient instances.

### Styling
- **Tailwind CSS**: Use utility classes for styling.
- **Shadcn UI**: Use the provided components in `src/components/ui` for consistency. Do not reinvent common UI elements like Buttons, Inputs, or Dialogs.
- **Responsiveness**: Always design Mobile-First. Use `md:`, `lg:` prefixes for larger screens.

### Authentication
- **Protection**: Use `getServerAuthSession()` in Server Components or `useSession()` in Client Components to check auth state.
- **Role Checks**: Verify `user.role` or `user.activeRole` before allowing access to sensitive actions (e.g., creating experiences).

### State Management
- **URL State**: Prefer URL search params for filter/sort state (shareable and bookmarkable).
- **Server Actions**: Use Server Actions for mutations (form submissions) instead of API routes where possible, for better type safety and progressive enhancement.

## 6. Workflow for New Tasks
1.  **Analyze**: Understand the requirement and how it fits into the existing schema.
2.  **Plan**: If database changes are needed, define them first.
3.  **Implement**:
    -   Update Schema (if needed).
    -   Create/Update UI Components.
    -   Implement Logic (Server Actions/API).
4.  **Verify**: Run local tests and ensure no regressions.

## 7. Environment Variables
- Ensure `.env` is properly set up with `DATABASE_URL`, `NEXTAUTH_SECRET`, and other provider keys before running the app.
